<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RM数据拓展编辑器</title>
    <link rel="stylesheet" href="../css/styles.css">
    <!-- Monaco Editor -->
    <script src="../node_modules/monaco-editor/min/vs/loader.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        .container {
            width: 100%;
            height: 100%;
        }

        /* Monaco Editor 容器样式 */
        #codeEditor {
            width: 100%;
            height: 100%;
        }

        .code-editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- 主容器 -->
        <div class="main-content">
            <!-- 左侧面板：项目列表 -->
            <div class="left-panel">
                <div class="panel-header">
                    <h2>项目列表</h2>
                </div>
                <div class="left-panel-actions hidden" id="projectActions">
                    <button id="itemNewBtn" class="action-btn small">新建</button>
                    <button id="itemCopyBtn" class="action-btn small secondary">复制</button>
                    <button id="itemDeleteBtn" class="action-btn small danger">删除</button>
                    <button id="itemSaveBtn" class="action-btn small primary">保存任务</button>
                </div>
                <!-- ✅ 滚动容器包装 -->
                <div class="list-scroll-wrapper">
                    <div id="itemList" class="item-list">
                        <div class="empty-state">打开菜单选择文件</div>
                    </div>
                </div>
            </div>
            <!-- 空状态提示面板 -->
            <div id="emptyStatePanel" class="empty-state-panel">
                <div class="empty-state-content">
                    <div class="empty-state-icon">📁</div>
                    <h2>请选择文件</h2>
                    <p>请通过菜单栏的"文件" → "打开文件"来选择要编辑的数据文件</p>
                </div>
            </div>
            <!-- 中侧面板：脚本列表 -->
            <div class="middle-panel hidden" id="scriptPanel">
                <div class="panel-header">
                    <h2>脚本列表</h2>
                </div>
                <!-- ✅ 滚动容器包装 -->
                <div class="list-scroll-wrapper">
                    <div id="scriptList" class="script-list">
                        <div class="empty-state">选择项目以查看脚本</div>
                    </div>
                </div>
            </div>
            <!-- 中侧面板：元数据展示 -->
            <div class="middle-panel hidden" id="metaDataPanel">
                <div class="panel-header">
                    <h2>元数据</h2>
                </div>
                <!-- ✅ 滚动容器包装 -->
                <div class="list-scroll-wrapper">
                    <div id="metaDataList" class="meta-data-list">
                        <div class="empty-state">选择项目以查看元数据</div>
                    </div>
                </div>
            </div>
            <!-- 代码编辑器 -->
            <div id="codeEditorContainer" class="code-editor-container hidden">
                <div class="panel-header">
                    <h2>代码编辑</h2>
                </div>
                <div class="code-editor-wrapper">
                    <div id="codeEditor" class="code-editor"></div>
                </div>
                <div class="code-actions">
                    <button id="saveCodeBtn" class="save-btn">保存代码</button>
                    <button id="clearCodeBtn" class="clear-btn">清空</button>
                </div>
                <div id="codeFilePath" class="file-path">项目：待选择</div>
            </div>
            <div id="propertyModePanel" class="property-panel hidden">
                <div class="panel-header">
                    <h2>属性定义</h2>
                    <div class="property-panel-actions">
                        <button id="savePropertiesBtn" class="save-btn">保存属性</button>
                    </div>
                </div>
                <div id="propertyModeSubtitle" class="property-mode-subtitle">请选择左侧项目以加载属性</div>
                <div class="property-base-grid" id="propertyBaseGrid"></div>
                <div class="custom-attributes">
                    <div class="custom-attributes-header">
                        <span>自定义属性</span>
                        <button id="addCustomPropertyBtn" class="action-btn small">添加</button>
                    </div>
                    <div id="customAttributeList" class="custom-attribute-list">
                        <div class="custom-empty">请选择项目或点击添加自定义属性</div>
                    </div>
                </div>
            </div>
            <div id="noteModePanel" class="note-panel hidden">
                <div class="panel-header">
                    <h2>备注编辑</h2>
                    <div class="note-panel-actions">
                        <button id="saveDescriptionBtn" class="save-btn note-description-btn">保存描述</button>
                    </div>
                </div>
                <div id="noteModeSubtitle" class="note-mode-subtitle">请选择左侧项目以编辑备注</div>
                <div class="note-description-wrapper">
                    <label for="noteDescription" class="note-description-label">附加描述</label>
                    <textarea id="noteDescription" class="note-description" placeholder="输入描述（保存后写入 description 数组）"
                        spellcheck="false"></textarea>
                    <button id="saveNoteBtn" class="save-btn">保存备注</button>
                </div>
                <div class="note-editor-wrapper">
                    <textarea id="noteEditor" class="note-editor" placeholder="请输入备注内容，支持换行..."
                        spellcheck="false"></textarea>
                </div>
            </div>
            <div id="projectileModePanel" class="projectile-panel hidden">
                <div class="projectile-panel-scroll">
                    <div class="projectile-top-grid">
                        <div class="projectile-left-column">
                            <div class="projectile-data-column">
                                <div class="projectile-data-section">
                                    <div class="projectile-data-row">
                                        <span class="projectile-data-title">动画数据</span>
                                        <div class="projectile-data-controls">
                                            <select id="projectileAnimationFileSelect"
                                                class="projectile-file-select"></select>
                                            <button id="projectileAnimationLoadBtn" class="projectile-load-btn"
                                                data-type="animation">加载</button>
                                            <button id="projectileAnimationPickBtn" class="projectile-pick-btn"
                                                data-type="animation">选择文件</button>
                                        </div>
                                        <span id="projectileAnimationStatus" class="projectile-data-status">尚未加载</span>
                                    </div>
                                    <div class="projectile-data-row">
                                        <span class="projectile-data-title">敌人数据</span>
                                        <div class="projectile-data-controls">
                                            <select id="projectileEnemyFileSelect"
                                                class="projectile-file-select"></select>
                                            <button id="projectileEnemyLoadBtn" class="projectile-load-btn"
                                                data-type="enemy">加载</button>
                                            <button id="projectileEnemyPickBtn" class="projectile-pick-btn"
                                                data-type="enemy">选择文件</button>
                                        </div>
                                        <span id="projectileEnemyStatus" class="projectile-data-status">尚未加载</span>
                                    </div>
                                    <div class="projectile-data-row">
                                        <span class="projectile-data-title">技能数据</span>
                                        <div class="projectile-data-controls">
                                            <select id="projectileSkillFileSelect"
                                                class="projectile-file-select"></select>
                                            <button id="projectileSkillLoadBtn" class="projectile-load-btn"
                                                data-type="skill">加载</button>
                                            <button id="projectileSkillPickBtn" class="projectile-pick-btn"
                                                data-type="skill">选择文件</button>
                                        </div>
                                        <span id="projectileSkillStatus" class="projectile-data-status">尚未加载</span>
                                    </div>
                                    <div class="projectile-data-row">
                                        <span class="projectile-data-title">玩家数据</span>
                                        <div class="projectile-data-controls">
                                            <select id="projectileActorFileSelect"
                                                class="projectile-file-select"></select>
                                            <button id="projectileActorLoadBtn" class="projectile-load-btn"
                                                data-type="actor">加载</button>
                                            <button id="projectileActorPickBtn" class="projectile-pick-btn"
                                                data-type="actor">选择文件</button>
                                        </div>
                                        <span id="projectileActorStatus" class="projectile-data-status">尚未加载</span>
                                    </div>
                                    <div class="projectile-data-row">
                                        <span class="projectile-data-title">武器数据</span>
                                        <div class="projectile-data-controls">
                                            <select id="projectileWeaponFileSelect"
                                                class="projectile-file-select"></select>
                                            <button id="projectileWeaponLoadBtn" class="projectile-load-btn"
                                                data-type="weapon">加载</button>
                                            <button id="projectileWeaponPickBtn" class="projectile-pick-btn"
                                                data-type="weapon">选择文件</button>
                                        </div>
                                        <span id="projectileWeaponStatus" class="projectile-data-status">尚未加载</span>
                                    </div>
                                </div>
                            </div>
                            <div class="projectile-template-section">
                                <div class="projectile-template-row">
                                    <button id="projectileCreateTemplateBtn"
                                        class="action-btn secondary projectile-create-btn">新建弹道数据</button>
                                    <button id="projectileDeleteTemplateBtn"
                                        class="action-btn danger projectile-delete-btn">删除当前弹道</button>
                                </div>
                                <div class="projectile-template-grid">
                                    <label>
                                        名称
                                        <input id="projectileTemplateName" type="text" placeholder="基础弹道">
                                    </label>
                                    <label>
                                        起始动画 ID
                                        <select id="projectileStartAnimationSelect" class="theme-select"></select>
                                    </label>
                                    <label>
                                        发射动画 ID
                                        <select id="projectileLaunchAnimationSelect" class="theme-select"></select>
                                    </label>
                                    <label>
                                        结束动画 ID
                                        <select id="projectileEndAnimationSelect" class="theme-select"></select>
                                    </label>
                                </div>
                                <div class="projectile-template-actions">
                                    <button id="projectileSaveTemplateBtn" class="action-btn">保存模板</button>
                                </div>
                            </div>
                        </div>
                        <div class="projectile-right-column">
                            <div class="projectile-offset-column">
                                <div class="projectile-offset-card">
                                    <h3>角色弹道偏移</h3>
                                    <div class="projectile-offset-grid">
                                        <label>
                                            <span>角色</span>
                                        <select id="projectileActorSelect" class="theme-select"></select>
                                        </label>
                                        <label>
                                            <span>武器</span>
                                        <select id="projectileWeaponOffsetSelect" class="theme-select"></select>
                                        </label>
                                        <label>
                                            <span>Offset X</span>
                                            <input id="projectileActorOffsetX" type="number" value="0">
                                        </label>
                                        <label>
                                            <span>Offset Y</span>
                                            <input id="projectileActorOffsetY" type="number" value="0">
                                        </label>
                                    </div>
                                    <div class="projectile-offset-actions">
                                        <button id="projectileActorOffsetSaveBtn" class="action-btn small">保存</button>
                                    </div>
                                </div>
                                <div class="projectile-offset-card">
                                    <h3>敌人弹道偏移</h3>
                                    <div class="projectile-offset-grid">
                                        <label>
                                            <span>敌人</span>
                                        <select id="projectileEnemySelect" class="theme-select"></select>
                                        </label>
                                        <label>
                                            <span>技能</span>
                                        <select id="projectileSkillSelect" class="theme-select"></select>
                                        </label>
                                        <label>
                                            <span>Offset X</span>
                                            <input id="projectileEnemyOffsetX" type="number" value="0">
                                        </label>
                                        <label>
                                            <span>Offset Y</span>
                                            <input id="projectileEnemyOffsetY" type="number" value="0">
                                        </label>
                                    </div>
                                    <div class="projectile-offset-actions">
                                        <button id="projectileEnemyOffsetSaveBtn" class="action-btn small">保存</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="projectile-trajectory-layout">
                        <div class="projectile-trajectory-section">
                            <div class="projectile-trajectory-header">
                                <span>弹道轨迹节点</span>
                                <div class="projectile-segment-actions">
                                    <button id="projectileAddSegmentBtn" class="action-btn tiny">新增节点</button>
                                    <button id="projectileClearSegmentsBtn"
                                        class="action-btn tiny secondary">清空节点</button>
                                </div>
                            </div>
                            <div id="projectileSegmentList" class="projectile-segment-list"></div>
                        </div>
                        <div class="projectile-role-card projectile-launch-card">
                            <div class="projectile-role-row">
                                <label>
                                    发射者
                                    <select id="projectileEmitterRoleSelect" class="theme-select">
                                        <option value="actor">友方</option>
                                        <option value="enemy">敌方</option>
                                    </select>
                                </label>
                                <label>
                                    角色/敌人
                                    <select id="projectileEmitterCharacterSelect" class="theme-select"></select>
                                </label>
                            </div>
                            <div class="projectile-role-row">
                                <label>
                                    目标类型
                                    <select id="projectileTargetRoleSelect" class="theme-select">
                                        <option value="actor">友方</option>
                                        <option value="enemy">敌方</option>
                                    </select>
                                </label>
                                <label>
                                    角色/敌人
                                    <select id="projectileTargetCharacterSelect" class="theme-select"></select>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="projectile-engine-section">
                        <div class="projectile-preview-wrapper">
                            <div id="projectilePreviewContainer" class="projectile-preview"></div>
                            <button id="projectilePlayTestBtn" class="action-btn projectile-play-btn">播放</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="questModePanel" class="quest-panel hidden"></div>
        </div>
        <!-- 底部状态栏 -->
        <div class="status-bar">
            <span id="statusText" class="status-text">就绪</span>
            <span id="statsInfo" class="stats-info">
                <span id="characterCount">0</span> 个字符 |
                <span id="lineCount">0</span> 行
            </span>
        </div>
        <!-- 输入对话框 -->
        <div id="inputDialog" class="input-dialog hidden">
            <div class="input-dialog-content">
                <div class="input-dialog-header">
                    <h3 id="inputDialogTitle">输入</h3>
                </div>
                <div class="input-dialog-body">
                    <p id="inputDialogMessage"></p>
                    <input type="text" id="inputDialogInput" class="input-dialog-input" placeholder="请输入...">
                </div>
                <div class="input-dialog-actions">
                    <button id="inputDialogConfirm" class="input-dialog-confirm">确定</button>
                    <button id="inputDialogCancel" class="input-dialog-cancel">取消</button>
                </div>
            </div>
        </div>
        <!-- 加载指示器 -->
        <div id="loadingIndicator" class="loading-indicator hidden">
            <div class="spinner"></div>
            <p id="loadingText">加载中...</p>
        </div>
        <!-- 历史文件列表对话框 -->
        <div id="historyFilesDialog" class="history-files-dialog hidden">
            <div class="history-files-dialog-content">
                <div class="history-files-dialog-header">
                    <h3>历史文件</h3>
                    <button id="historyFilesDialogClose" class="history-files-dialog-close">×</button>
                </div>
                <div class="history-files-dialog-body">
                    <div id="historyFilesList" class="history-files-list"></div>
                </div>
            </div>
        </div>
    </div>
    <script src="../js/Zaun_Core.js"></script>
    <script src="../js/Zaun_Projectile.js"></script>
    <script src="../js/main.js"></script>
</body>

</html>